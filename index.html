<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‡é¥å®¢æˆ·ç«¯ - ç³»ç»Ÿç›‘æ§</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="a" cx="0.5" cy="0.5" r="0.5"><stop offset="0%" stop-color="%23007acc"/><stop offset="100%" stop-color="%23004a7f"/></radialGradient></defs><rect width="100" height="100" fill="url(%23a)" opacity="0.3"/></svg>');
            height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        /* è‡ªå®šä¹‰æ ‡é¢˜æ æ ·å¼ */
        .custom-titlebar {
            height: 32px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            -webkit-app-region: drag;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .titlebar-title {
            font-size: 13px;
            font-weight: 500;
            opacity: 0.9;
            margin-left: 8px;
        }
        
        .titlebar-controls {
            display: flex;
            gap: 4px;
            -webkit-app-region: no-drag;
        }
        
        .titlebar-button {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            border-radius: 4px;
        }
        
        .titlebar-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .titlebar-button.close:hover {
            background: #e74c3c;
        }
        
        .titlebar-button.minimize:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .titlebar-button.maximize:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* çª—å£æ§åˆ¶é¢æ¿ */
        .window-controls-panel {
            position: fixed;
            top: 40px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 200px;
        }
        
        .control-group {
            margin-bottom: 16px;
        }
        
        .control-group:last-child {
            margin-bottom: 0;
        }
        
        .control-group h3 {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .control-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .control-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .drag-handle {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            -webkit-app-region: no-drag;
        }
        
        .drag-handle:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* è·¨å¹³å°ç‰¹å®šæ ·å¼ */
        .platform-windows .titlebar-button {
            border-radius: 0;
        }
        
        .platform-windows .titlebar-button.close:hover {
            background: #e74c3c;
        }
        
        .platform-windows .titlebar-button.minimize:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .platform-windows .titlebar-button.maximize:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .platform-macos .titlebar-button {
            width: 28px;
            height: 28px;
            border-radius: 14px;
            margin-left: 4px;
        }
        
        .platform-macos .titlebar-button.close {
            background: #ff5f57;
        }
        
        .platform-macos .titlebar-button.minimize {
            background: #ffbd2e;
        }
        
        .platform-macos .titlebar-button.maximize {
            background: #28ca42;
        }
        
        .platform-macos .titlebar-button:hover {
            opacity: 0.8;
        }
        
        .platform-linux .titlebar-button {
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .platform-linux .titlebar-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 600px) {
            .window-controls-panel {
                right: 10px;
                left: 10px;
                min-width: auto;
            }
            
            .control-buttons {
                grid-template-columns: 1fr;
            }
            
            .custom-titlebar {
                height: 40px;
            }
            
            .titlebar-button {
                width: 36px;
                height: 36px;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
        }
        
        /* ç³»ç»Ÿç›‘æ§é¢æ¿ */
        .system-monitor {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .monitor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .monitor-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
        }
        
        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .monitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .hardware-info, .performance-monitor {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .info-value {
            font-size: 0.9rem;
            font-weight: 500;
            color: white;
        }
        
        /* è¿›åº¦æ¡æ ·å¼ */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .progress-fill.cpu {
            background: linear-gradient(90deg, #2196F3, #03A9F4);
        }
        
        .progress-fill.gpu {
            background: linear-gradient(90deg, #FF9800, #FFC107);
        }
        
        .progress-fill.memory {
            background: linear-gradient(90deg, #E91E63, #F06292);
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 2px;
        }
        
        /* åº”ç”¨ä¿¡æ¯é¢æ¿ */
        .app-info {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .app-logo {
            font-size: 4rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .app-title {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 5px;
        }
        
        .app-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .app-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .app-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .app-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .app-version {
            margin-top: 15px;
            font-size: 0.8rem;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <!-- è‡ªå®šä¹‰æ ‡é¢˜æ  -->
    <div class="custom-titlebar">
        <div class="titlebar-title">ä¸‡é¥å®¢æˆ·ç«¯</div>
        <div class="titlebar-controls">
            <button class="titlebar-button minimize" onclick="minimizeWindow()" title="æœ€å°åŒ–">âˆ’</button>
            <button class="titlebar-button maximize" onclick="toggleMaximizeWindow()" title="æœ€å¤§åŒ–/è¿˜åŸ">â–¡</button>
            <button class="titlebar-button close" onclick="closeWindow()" title="å…³é—­">Ã—</button>
        </div>
    </div>
    
    <!-- çª—å£æ§åˆ¶é¢æ¿ -->
    <div class="window-controls-panel" id="controlsPanel" style="display: none;">
        <div class="control-group">
            <h3>çª—å£æ§åˆ¶</h3>
            <div class="control-buttons">
                <button class="control-button" onclick="resizeToHalf()">è°ƒæ•´åˆ°50%</button>
                <button class="control-button" onclick="restoreOriginalSize()">æ¢å¤åŸå§‹å¤§å°</button>
                <button class="control-button" onclick="toggleMaximizeWindow()">æœ€å¤§åŒ–/è¿˜åŸ</button>
                <button class="control-button" onclick="minimizeWindow()">æœ€å°åŒ–</button>
                <button class="control-button" onclick="closeWindow()">å…³é—­</button>
            </div>
        </div>
        <div class="control-group">
            <h3>æ‹–æ‹½æ§åˆ¶</h3>
            <div class="control-buttons">
                <button class="control-button" onclick="enableDrag()">å¯ç”¨æ‹–æ‹½</button>
                <button class="control-button" onclick="disableDrag()">ç¦ç”¨æ‹–æ‹½</button>
            </div>
        </div>
    </div>
    
    <!-- æ‹–æ‹½æ‰‹æŸ„ -->
    <div class="drag-handle" id="dragHandle" title="æ‹–æ‹½çª—å£">â‰¡</div>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- ç³»ç»Ÿç›‘æ§é¢æ¿ -->
        <div class="system-monitor">
            <div class="monitor-header">
                <h2 class="monitor-title">ç³»ç»Ÿç›‘æ§</h2>
                <button class="refresh-btn" onclick="refreshSystemInfo()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            </div>
            
            <div class="monitor-grid">
                <!-- ç¡¬ä»¶ä¿¡æ¯ -->
                <div class="hardware-info">
                    <h3 class="section-title">ç¡¬ä»¶ä¿¡æ¯</h3>
                    <div class="info-item">
                        <span class="info-label">CPUå‹å·</span>
                        <span class="info-value" id="cpuModel">æ£€æµ‹ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">GPUå‹å·</span>
                        <span class="info-value" id="gpuModel">æ£€æµ‹ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å†…å­˜å‹å·</span>
                        <span class="info-value" id="memoryModel">æ£€æµ‹ä¸­...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ“ä½œç³»ç»Ÿ</span>
                        <span class="info-value" id="osInfo">æ£€æµ‹ä¸­...</span>
                    </div>
                </div>
                
                <!-- æ€§èƒ½ç›‘æ§ -->
                <div class="performance-monitor">
                    <h3 class="section-title">æ€§èƒ½ç›‘æ§</h3>
                    <div class="info-item">
                        <span class="info-label">CPUåˆ©ç”¨ç‡</span>
                        <span class="info-value" id="cpuUsage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill cpu" id="cpuProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-info">
                        <span>0%</span>
                        <span id="cpuTemp">æ¸©åº¦: æ£€æµ‹ä¸­...</span>
                    </div>
                    
                    <div class="info-item">
                        <span class="info-label">GPUåˆ©ç”¨ç‡</span>
                        <span class="info-value" id="gpuUsage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill gpu" id="gpuProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-info">
                        <span>0%</span>
                        <span id="gpuTemp">æ¸©åº¦: æ£€æµ‹ä¸­...</span>
                    </div>
                    
                    <div class="info-item">
                        <span class="info-label">å†…å­˜åˆ©ç”¨ç‡</span>
                        <span class="info-value" id="memoryUsage">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill memory" id="memoryProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-info">
                        <span id="memoryUsed">0 GB</span>
                        <span id="memoryTotal">æ€»å†…å­˜: æ£€æµ‹ä¸­...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº”ç”¨ä¿¡æ¯é¢æ¿ -->
        <div class="app-info">
            <div class="app-logo">ğŸš€</div>
            <h1 class="app-title">ä¸‡é¥å®¢æˆ·ç«¯</h1>
            <div class="app-subtitle">ç³»ç»Ÿç›‘æ§ä¸æ€§èƒ½åˆ†æå·¥å…·</div>
            
            <div class="app-buttons">
                <button class="app-button" onclick="showMessage('æ¬¢è¿ä½¿ç”¨ä¸‡é¥å®¢æˆ·ç«¯ç³»ç»Ÿç›‘æ§å·¥å…·ï¼')">å¼€å§‹ä½¿ç”¨</button>
                <button class="app-button" onclick="toggleControlsPanel()">çª—å£æ§åˆ¶</button>
            </div>
            
            <div class="app-version">ç‰ˆæœ¬ 2.0.0 | åŸºäº Tauri æ¡†æ¶ | å®æ—¶ç›‘æ§ç³»ç»Ÿ</div>
            
            <!-- çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="status-container" style="margin-top: 15px; padding: 8px 12px; background: rgba(255, 255, 255, 0.2); border-radius: 8px; font-size: 0.85rem; text-align: center;">
                <span id="status">åº”ç”¨å·²å‡†å¤‡å°±ç»ª</span>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–åº”ç”¨
        console.log('ä¸‡é¥å®¢æˆ·ç«¯ç•Œé¢å·²åŠ è½½');
        
        // çª—å£æ§åˆ¶çŠ¶æ€
        let isMaximized = false;
        let isDraggingEnabled = true;
        let originalSize = { width: 800, height: 600 };
        let isTauriEnvironment = false;
        let systemInfoInterval = null;
        
        // æ£€æµ‹Tauriç¯å¢ƒ
        function detectTauriEnvironment() {
            isTauriEnvironment = !!(window.__TAURI__);
            console.log('Tauriç¯å¢ƒæ£€æµ‹:', isTauriEnvironment ? 'æ˜¯' : 'å¦');
            return isTauriEnvironment;
        }
        
        // è·å–ç³»ç»Ÿä¿¡æ¯
        async function getSystemInfo() {
            try {
                console.log("=== å¼€å§‹æ‰§è¡ŒgetSystemInfoå‡½æ•° ===");
                
                if (detectTauriEnvironment()) {
                    console.log("1. æ£€æµ‹åˆ°Tauriç¯å¢ƒ");
                    console.log("2. å‡†å¤‡è°ƒç”¨Ruståç«¯å‡½æ•°get_system_info");
                    
                    // Tauri v2ç¯å¢ƒï¼šè°ƒç”¨åç«¯Rustå‡½æ•°
                    const systemInfo = await window.__TAURI__.invoke('get_system_info');
                    console.log("3. Ruståç«¯è¿”å›çš„ç³»ç»Ÿä¿¡æ¯:", systemInfo);
                    
                    // æ£€æŸ¥è¿”å›çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆ
                    if (systemInfo && systemInfo.cpu_name && systemInfo.cpu_name !== 'æœªçŸ¥CPU') {
                        console.log("4. æ•°æ®æœ‰æ•ˆï¼Œæ ‡è®°ä¸ºçœŸå®æ•°æ®");
                        systemInfo.is_simulated = false;
                        showMessage('âœ“ æˆåŠŸè·å–çœŸå®ç¡¬ä»¶ä¿¡æ¯');
                        console.log("5. è¿”å›çœŸå®æ•°æ®ç»™å‰ç«¯");
                        return systemInfo;
                    } else {
                        console.log("4. æ•°æ®æ— æ•ˆï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®");
                        showMessage('âš  Ruståç«¯è¿”å›æ— æ•ˆæ•°æ®ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                        const simulatedData = getFallbackSystemInfo();
                        console.log("5. è¿”å›æ¨¡æ‹Ÿæ•°æ®ç»™å‰ç«¯:", simulatedData);
                        return simulatedData;
                    }
                } else {
                    console.log("1. æ£€æµ‹åˆ°æµè§ˆå™¨ç¯å¢ƒ");
                    console.log("2. ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®");
                    showMessage('âš  æµè§ˆå™¨ç¯å¢ƒé™åˆ¶ï¼šæ— æ³•è®¿é—®çœŸå®ç¡¬ä»¶ä¿¡æ¯');
                    const simulatedData = getFallbackSystemInfo();
                    console.log("3. è¿”å›æ¨¡æ‹Ÿæ•°æ®ç»™å‰ç«¯:", simulatedData);
                    return simulatedData;
                }
            } catch (error) {
                console.error("=== æ•è·åˆ°é”™è¯¯ ===");
                console.error("é”™è¯¯ç±»å‹:", error.name);
                console.error("é”™è¯¯æ¶ˆæ¯:", error.message);
                console.error("é”™è¯¯å †æ ˆ:", error.stack);
                
                // æ˜¾ç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯
                let errorMessage = 'è·å–ç¡¬ä»¶ä¿¡æ¯å¤±è´¥: ';
                if (error.message.includes('get_system_info')) {
                    errorMessage += 'Ruståç«¯å‡½æ•°è°ƒç”¨å¤±è´¥';
                } else if (error.message.includes('invoke')) {
                    errorMessage += 'Tauri IPCé€šä¿¡å¤±è´¥';
                } else {
                    errorMessage += error.message;
                }
                
                showMessage('âŒ ' + errorMessage);
                
                // å¦‚æœRustè°ƒç”¨å¤±è´¥ï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®
                const simulatedData = {
                    cpu_usage: Math.random() * 100,
                    cpu_name: 'Intel(R) Core(TM) i7-11700F (æ¨¡æ‹Ÿæ•°æ®)',
                    cpu_cores: 8,
                    memory_total: 34359738368, // 32GB
                    memory_used: Math.random() * 17179869184, // 0-16GB
                    memory_usage: Math.random() * 100,
                    gpu_name: 'NVIDIA GeForce RTX 3060 (æ¨¡æ‹Ÿæ•°æ®)',
                    gpu_usage: Math.random() * 100,
                    os_name: 'Windows 11',
                    os_version: '22H2',
                    is_simulated: true // æ ‡è®°ä¸ºæ¨¡æ‹Ÿæ•°æ®
                };
                console.log("é”™è¯¯å¤„ç†: è¿”å›æ¨¡æ‹Ÿæ•°æ®:", simulatedData);
                return simulatedData;
            }
        }
        
        // æ›´æ–°ç•Œé¢æ˜¾ç¤º
        function updateSystemInfoDisplay(systemInfo) {
            if (!systemInfo) {
                console.error('ç³»ç»Ÿä¿¡æ¯ä¸ºç©º');
                showMessage('âŒ ç³»ç»Ÿä¿¡æ¯ä¸ºç©º');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ¨¡æ‹Ÿæ•°æ®
            const isSimulated = systemInfo.is_simulated || systemInfo.cpu_name.includes('æ¨¡æ‹Ÿæ•°æ®');
            
            // æ›´æ–°ç¡¬ä»¶ä¿¡æ¯ï¼Œå¹¶æ ‡è®°æ¨¡æ‹Ÿæ•°æ®
            document.getElementById('cpuModel').textContent = systemInfo.cpu_name;
            document.getElementById('gpuModel').textContent = systemInfo.gpu_name;
            document.getElementById('memoryModel').textContent = `${(systemInfo.memory_total / 1024 / 1024 / 1024).toFixed(1)} GB`;
            document.getElementById('osInfo').textContent = `${systemInfo.os_name} ${systemInfo.os_version}`;
            
            // æ·»åŠ æ•°æ®æ¥æºæ ‡è®°
            const dataSource = isSimulated ? ' (æ¨¡æ‹Ÿæ•°æ®)' : ' (çœŸå®æ•°æ®)';
            document.getElementById('cpuModel').textContent += dataSource;
            document.getElementById('gpuModel').textContent += dataSource;
            
            // æ›´æ–°æ€§èƒ½ç›‘æ§
            const cpuUsage = Math.round(systemInfo.cpu_usage);
            document.getElementById('cpuUsage').textContent = `${cpuUsage}%`;
            document.getElementById('cpuProgress').style.width = `${cpuUsage}%`;
            
            const gpuUsage = Math.round(systemInfo.gpu_usage);
            document.getElementById('gpuUsage').textContent = `${gpuUsage}%`;
            document.getElementById('gpuProgress').style.width = `${gpuUsage}%`;
            
            const memoryUsage = Math.round(systemInfo.memory_usage);
            document.getElementById('memoryUsage').textContent = `${memoryUsage}%`;
            document.getElementById('memoryProgress').style.width = `${memoryUsage}%`;
            
            // æ›´æ–°å†…å­˜è¯¦ç»†ä¿¡æ¯
            const memoryUsedGB = (systemInfo.memory_used / 1024 / 1024 / 1024).toFixed(1);
            const memoryTotalGB = (systemInfo.memory_total / 1024 / 1024 / 1024).toFixed(1);
            document.getElementById('memoryUsed').textContent = `${memoryUsedGB} GB`;
            document.getElementById('memoryTotal').textContent = `æ€»å†…å­˜: ${memoryTotalGB} GB`;
            
            // æ›´æ–°æ¸©åº¦ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿï¼‰
            document.getElementById('cpuTemp').textContent = `æ¸©åº¦: ${Math.round(30 + Math.random() * 50)}Â°C`;
            document.getElementById('gpuTemp').textContent = `æ¸©åº¦: ${Math.round(35 + Math.random() * 45)}Â°C`;
            
            // æ›´æ–°çŠ¶æ€æ æ˜¾ç¤ºæ•°æ®æ¥æº
            const statusElement = document.getElementById('status');
            if (isSimulated) {
                statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
                statusElement.textContent = 'âš  å½“å‰æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ® - æ— æ³•è·å–çœŸå®ç¡¬ä»¶ä¿¡æ¯';
            } else {
                statusElement.style.background = 'rgba(76, 175, 80, 0.3)';
                statusElement.textContent = 'âœ“ æ­£åœ¨æ˜¾ç¤ºçœŸå®ç¡¬ä»¶ä¿¡æ¯';
            }
        }
        
        // åˆ·æ–°ç³»ç»Ÿä¿¡æ¯
        async function refreshSystemInfo() {
            console.log('åˆ·æ–°ç³»ç»Ÿä¿¡æ¯...');
            const systemInfo = await getSystemInfo();
            updateSystemInfoDisplay(systemInfo);
        }
        
        // å¯åŠ¨å®æ—¶ç›‘æ§
        function startRealTimeMonitoring() {
            if (systemInfoInterval) {
                clearInterval(systemInfoInterval);
            }
            
            // ç«‹å³åˆ·æ–°ä¸€æ¬¡
            refreshSystemInfo();
            
            // è®¾ç½®å®šæ—¶åˆ·æ–°ï¼ˆæ¯2ç§’ï¼‰
            systemInfoInterval = setInterval(refreshSystemInfo, 2000);
            console.log('å®æ—¶ç›‘æ§å·²å¯åŠ¨ï¼Œæ¯2ç§’åˆ·æ–°ä¸€æ¬¡');
        }
        
        // åœæ­¢å®æ—¶ç›‘æ§
        function stopRealTimeMonitoring() {
            if (systemInfoInterval) {
                clearInterval(systemInfoInterval);
                systemInfoInterval = null;
                console.log('å®æ—¶ç›‘æ§å·²åœæ­¢');
            }
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯å‡½æ•°
        function showMessage(message) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.style.background = 'rgba(76, 175, 80, 0.3)';
            
            setTimeout(() => {
                status.textContent = 'åº”ç”¨å·²å‡†å¤‡å°±ç»ª';
                status.style.background = 'rgba(255, 255, 255, 0.2)';
            }, 2000);
        }
        
        // çª—å£æ§åˆ¶å‡½æ•°
        async function closeWindow() {
            try {
                if (detectTauriEnvironment()) {
                    // Tauri v2 è¯­æ³•
                    await window.__TAURI__.window.getCurrent().close();
                } else {
                    // æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿ
                    if (confirm('ç¡®å®šè¦å…³é—­çª—å£å—ï¼Ÿ')) {
                        window.close();
                    }
                }
            } catch (error) {
                console.error('å…³é—­çª—å£å¤±è´¥:', error);
                showMessage('å…³é—­çª—å£å¤±è´¥: ' + error.message);
            }
        }
        
        async function minimizeWindow() {
            try {
                if (detectTauriEnvironment()) {
                    // Tauri v2 è¯­æ³•
                    await window.__TAURI__.window.getCurrent().minimize();
                    showMessage('çª—å£å·²æœ€å°åŒ–');
                } else {
                    // æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿ
                    showMessage('æœ€å°åŒ–åŠŸèƒ½åœ¨æµè§ˆå™¨ä¸­ä¸å¯ç”¨');
                }
            } catch (error) {
                console.error('æœ€å°åŒ–çª—å£å¤±è´¥:', error);
                showMessage('æœ€å°åŒ–çª—å£å¤±è´¥: ' + error.message);
            }
        }
        
        async function toggleMaximizeWindow() {
            try {
                if (detectTauriEnvironment()) {
                    // Tauri v2 è¯­æ³•
                    const currentWindow = window.__TAURI__.window.getCurrent();
                    if (isMaximized) {
                        await currentWindow.unmaximize();
                        isMaximized = false;
                        showMessage('çª—å£å·²è¿˜åŸ');
                    } else {
                        await currentWindow.maximize();
                        isMaximized = true;
                        showMessage('çª—å£å·²æœ€å¤§åŒ–');
                    }
                } else {
                    // æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿ
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                        isMaximized = false;
                        showMessage('å·²é€€å‡ºå…¨å±æ¨¡å¼');
                    } else {
                        document.documentElement.requestFullscreen();
                        isMaximized = true;
                        showMessage('å·²è¿›å…¥å…¨å±æ¨¡å¼');
                    }
                }
            } catch (error) {
                console.error('åˆ‡æ¢æœ€å¤§åŒ–çŠ¶æ€å¤±è´¥:', error);
                showMessage('åˆ‡æ¢æœ€å¤§åŒ–çŠ¶æ€å¤±è´¥: ' + error.message);
            }
        }
        
        async function resizeToHalf() {
            try {
                if (detectTauriEnvironment()) {
                    // Tauri v2 è¯­æ³•
                    const currentWindow = window.__TAURI__.window.getCurrent();
                    
                    // è·å–å½“å‰çª—å£å¤§å°
                    const currentSize = await currentWindow.innerSize();
                    const halfWidth = Math.max(400, Math.round(currentSize.width * 0.5));
                    const halfHeight = Math.max(300, Math.round(currentSize.height * 0.5));
                    
                    // è®¾ç½®æ–°å¤§å°
                    await currentWindow.setSize({
                        type: 'Logical',
                        data: { width: halfWidth, height: halfHeight }
                    });
                    showMessage(`çª—å£å·²è°ƒæ•´ä¸º: ${halfWidth} Ã— ${halfHeight}`);
                } else {
                    // åœ¨æµè§ˆå™¨ä¸­æ¨¡æ‹Ÿ
                    const newWidth = Math.max(400, Math.round(window.outerWidth * 0.5));
                    const newHeight = Math.max(300, Math.round(window.outerHeight * 0.5));
                    
                    window.resizeTo(newWidth, newHeight);
                    showMessage(`çª—å£å¤§å°å·²è°ƒæ•´ä¸º: ${newWidth} Ã— ${newHeight}`);
                }
            } catch (error) {
                console.error('è°ƒæ•´çª—å£å¤§å°å¤±è´¥:', error);
                showMessage('è°ƒæ•´çª—å£å¤§å°å¤±è´¥: ' + error.message);
            }
        }
        
        // æ¢å¤åŸå§‹å¤§å°
        async function restoreOriginalSize() {
            try {
                if (detectTauriEnvironment()) {
                    // Tauri v2 è¯­æ³•
                    const currentWindow = window.__TAURI__.window.getCurrent();
                    
                    await currentWindow.setSize({
                        type: 'Logical',
                        data: { width: originalSize.width, height: originalSize.height }
                    });
                    showMessage(`çª—å£å·²æ¢å¤ä¸º: ${originalSize.width} Ã— ${originalSize.height}`);
                } else {
                    // æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿ
                    window.resizeTo(originalSize.width, originalSize.height);
                    showMessage(`çª—å£å·²æ¢å¤ä¸º: ${originalSize.width} Ã— ${originalSize.height}`);
                }
            } catch (error) {
                console.error('æ¢å¤çª—å£å¤§å°å¤±è´¥:', error);
                showMessage('æ¢å¤çª—å£å¤§å°å¤±è´¥: ' + error.message);
            }
        }
        
function getFallbackSystemInfo() {
    return {
        cpu_usage: Math.random() * 100,
        cpu_name: 'Intel(R) Core(TM) i7-12700K',
        cpu_cores: 12,
        memory_total: 17179869184, // 16GB
        memory_used: Math.random() * 8589934592, // 0-8GB
        memory_usage: Math.random() * 100,
        gpu_name: 'NVIDIA GeForce RTX 3080',
        gpu_usage: Math.random() * 100,
        os_name: 'Windows 11',
        os_version: '22H2'
    };
}


        // æ‹–æ‹½æ§åˆ¶å‡½æ•°
        function enableDrag() {
            isDraggingEnabled = true;
            const dragHandle = document.getElementById('dragHandle');
            const titlebar = document.querySelector('.custom-titlebar');
            
            if (dragHandle) dragHandle.style.display = 'flex';
            if (titlebar) titlebar.style.webkitAppRegion = 'drag';
            
            showMessage('æ‹–æ‹½åŠŸèƒ½å·²å¯ç”¨');
        }
        
        function disableDrag() {
            isDraggingEnabled = false;
            const dragHandle = document.getElementById('dragHandle');
            const titlebar = document.querySelector('.custom-titlebar');
            
            if (dragHandle) dragHandle.style.display = 'none';
            if (titlebar) titlebar.style.webkitAppRegion = 'no-drag';
            
            showMessage('æ‹–æ‹½åŠŸèƒ½å·²ç¦ç”¨');
        }
        
        // çª—å£æ§åˆ¶é¢æ¿
        function toggleControlsPanel() {
            const panel = document.getElementById('controlsPanel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                panel.classList.add('slide-in');
                showMessage('çª—å£æ§åˆ¶é¢æ¿å·²æ‰“å¼€');
            } else {
                panel.classList.remove('slide-in');
                panel.style.display = 'none';
                showMessage('çª—å£æ§åˆ¶é¢æ¿å·²å…³é—­');
            }
        }
        
        // è·¨å¹³å°æ ·å¼é€‚é…
        function adaptPlatformStyles() {
            const userAgent = navigator.userAgent.toLowerCase();
            const body = document.body;
            
            // ç§»é™¤ç°æœ‰çš„å¹³å°ç±»
            body.classList.remove('platform-windows', 'platform-macos', 'platform-linux');
            
            if (userAgent.includes('win')) {
                // Windowsæ ·å¼
                body.classList.add('platform-windows');
                showMessage('Windowså¹³å°æ ·å¼å·²åº”ç”¨');
            } else if (userAgent.includes('mac')) {
                // macOSæ ·å¼
                body.classList.add('platform-macos');
                showMessage('macOSå¹³å°æ ·å¼å·²åº”ç”¨');
            } else {
                // Linuxå’Œå…¶ä»–å¹³å°
                body.classList.add('platform-linux');
                showMessage('Linuxå¹³å°æ ·å¼å·²åº”ç”¨');
            }
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message) {
            const statusElement = document.getElementById('status');
            if (statusElement) {
                statusElement.textContent = message;
                console.log('çŠ¶æ€æ¶ˆæ¯:', message);
            }
        }
        
        // åˆ·æ–°ç³»ç»Ÿä¿¡æ¯
        async function refreshSystemInfo() {
            try {
                showMessage('æ­£åœ¨åˆ·æ–°ç³»ç»Ÿä¿¡æ¯...');
                const systemInfo = await getSystemInfo();
                updateSystemInfoUI(systemInfo);
                showMessage('ç³»ç»Ÿä¿¡æ¯åˆ·æ–°å®Œæˆ');
            } catch (error) {
                console.error('åˆ·æ–°ç³»ç»Ÿä¿¡æ¯å¤±è´¥:', error);
                showMessage('åˆ·æ–°ç³»ç»Ÿä¿¡æ¯å¤±è´¥: ' + error.message);
            }
        }
        
        // æ›´æ–°ç³»ç»Ÿä¿¡æ¯UI
        function updateSystemInfoUI(systemInfo) {
            // æ›´æ–°ç¡¬ä»¶ä¿¡æ¯
            document.getElementById('cpuModel').textContent = systemInfo.cpu_name || 'æœªçŸ¥';
            document.getElementById('gpuModel').textContent = systemInfo.gpu_name || 'æœªçŸ¥';
            document.getElementById('memoryModel').textContent = formatBytes(systemInfo.memory_total) || 'æœªçŸ¥';
            document.getElementById('osInfo').textContent = `${systemInfo.os_name || 'æœªçŸ¥'} ${systemInfo.os_version || ''}`;
            
            // æ›´æ–°æ€§èƒ½ç›‘æ§
            document.getElementById('cpuUsage').textContent = `${Math.round(systemInfo.cpu_usage || 0)}%`;
            document.getElementById('cpuProgress').style.width = `${systemInfo.cpu_usage || 0}%`;
            
            document.getElementById('gpuUsage').textContent = `${Math.round(systemInfo.gpu_usage || 0)}%`;
            document.getElementById('gpuProgress').style.width = `${systemInfo.gpu_usage || 0}%`;
            
            document.getElementById('memoryUsage').textContent = `${Math.round(systemInfo.memory_usage || 0)}%`;
            document.getElementById('memoryProgress').style.width = `${systemInfo.memory_usage || 0}%`;
            
            // æ›´æ–°å†…å­˜ä½¿ç”¨æƒ…å†µ
            const memoryUsed = systemInfo.memory_used || 0;
            const memoryTotal = systemInfo.memory_total || 0;
            document.getElementById('memoryUsed').textContent = formatBytes(memoryUsed);
            document.getElementById('memoryTotal').textContent = `æ€»å†…å­˜: ${formatBytes(memoryTotal)}`;
        }
        
        // æ ¼å¼åŒ–å­—èŠ‚å¤§å°
        function formatBytes(bytes) {
            if (!bytes || bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // å¯åŠ¨å®æ—¶ç›‘æ§
        function startRealTimeMonitoring() {
            // åœæ­¢ç°æœ‰çš„å®šæ—¶å™¨
            if (systemInfoInterval) {
                clearInterval(systemInfoInterval);
            }
            
            // å¯åŠ¨æ–°çš„å®šæ—¶å™¨ï¼Œæ¯5ç§’åˆ·æ–°ä¸€æ¬¡
            systemInfoInterval = setInterval(async () => {
                try {
                    const systemInfo = await getSystemInfo();
                    updateSystemInfoUI(systemInfo);
                } catch (error) {
                    console.error('å®æ—¶ç›‘æ§æ›´æ–°å¤±è´¥:', error);
                }
            }, 5000);
            
            console.log('å®æ—¶ç›‘æ§å·²å¯åŠ¨');
        }
        
        // åœæ­¢å®æ—¶ç›‘æ§
        function stopRealTimeMonitoring() {
            if (systemInfoInterval) {
                clearInterval(systemInfoInterval);
                systemInfoInterval = null;
                console.log('å®æ—¶ç›‘æ§å·²åœæ­¢');
            }
        }
        
        // æ›´æ–°çª—å£çŠ¶æ€
        function updateWindowState() {
            // åœ¨Tauriç¯å¢ƒä¸­æ›´æ–°çª—å£çŠ¶æ€
            if (isTauriEnvironment) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ Tauriç‰¹å®šçš„çª—å£çŠ¶æ€æ›´æ–°é€»è¾‘
                console.log('çª—å£çŠ¶æ€å·²æ›´æ–°');
            }
        }
        
        // åˆå§‹åŒ–çª—å£æ§åˆ¶
        function initializeWindowControls() {
            detectTauriEnvironment();
            adaptPlatformStyles();
            enableDrag();
            
            // å¯åŠ¨å®æ—¶ç›‘æ§
            startRealTimeMonitoring();
            
            // æ·»åŠ é”®ç›˜å¿«æ·é”®
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    refreshSystemInfo();
                } else if (e.key === 'Escape') {
                    // ESCé”®å…³é—­æ§åˆ¶é¢æ¿
                    const panel = document.getElementById('controlsPanel');
                    if (panel.style.display === 'block') {
                        toggleControlsPanel();
                    }
                }
            });
            
            // æ·»åŠ çª—å£å¤§å°å˜åŒ–ç›‘å¬
            window.addEventListener('resize', () => {
                if (isTauriEnvironment) {
                    // åœ¨Tauriç¯å¢ƒä¸­ï¼Œçª—å£å¤§å°å˜åŒ–æ—¶æ›´æ–°çŠ¶æ€
                    updateWindowState();
                }
            });
            
            // æ˜¾ç¤ºåˆå§‹åŒ–å®Œæˆæ¶ˆæ¯
            const environmentInfo = isTauriEnvironment ? 'Tauriæ¡Œé¢åº”ç”¨' : 'Webæµè§ˆå™¨';
            console.log(`çª—å£æ§åˆ¶åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ - ç¯å¢ƒ: ${environmentInfo}`);
            showMessage(`ä¸‡é¥å®¢æˆ·ç«¯å·²å¯åŠ¨ - ç³»ç»Ÿç›‘æ§åŠŸèƒ½å·²æ¿€æ´» - ${environmentInfo}`);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ä¸‡é¥å®¢æˆ·ç«¯ç•Œé¢å·²åŠ è½½å®Œæˆ');
            
            // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ‰€æœ‰å…ƒç´ éƒ½å·²åŠ è½½
            setTimeout(() => {
                showMessage('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                initializeWindowControls();
            }, 500);
        });
        
        // é¡µé¢å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', () => {
            stopRealTimeMonitoring();
        });


    </script>
</body>
</html>